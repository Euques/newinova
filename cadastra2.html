<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Eventos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="estilo.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Cadastro de Eventos</h1>
        <form id="eventoForm">
            <!-- ... (seu formulário aqui) ... -->
            <button type="submit" class="btn btn-primary mt-2">Cadastrar Evento</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyCLEyAd_4-2n2ID0xTjwS1ouip9G9C6JDs",
            authDomain: "blacknight-600de.firebaseapp.com",
            projectId: "blacknight-600de",
            storageBucket: "blacknight-600de.appspot.com",
            messagingSenderId: "588926432348",
            appId: "1:588926432348:web:47b2b4a1b421d4b2a0e299",
            measurementId: "G-559VYPVJ5Q"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const cliente = "inova";

        const eventoForm = document.getElementById("eventoForm");

        eventoForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            // Obtenha os valores do formulário
            const dataEvento = document.getElementById("dataEvento").value;
            const horaEvento = document.getElementById("horaEvento").value;
            const fotoEvento = document.getElementById("fotoEvento").files[0];
            const descricao = document.getElementById("descricao").value;
            const promocao = document.getElementById("promocao").value;
            const regra = document.getElementById("regra").value;
            const link = document.getElementById("link").value;
            const buttonTitle = document.getElementById("buttonTitle").value;

            // Converter a data e hora para um timestamp (em milissegundos)
            const dataTimestamp = new Date(`${dataEvento}T${horaEvento}:00`).getTime();

            // Enviar a imagem para o Firebase Storage
            const storageRef = storage.ref(`${new Date().getFullYear()}/${cliente}/${fotoEvento.name}`);
            const snapshot = await storageRef.put(fotoEvento);
            const downloadURL = await snapshot.ref.getDownloadURL();

            // Salvar os dados do evento no Firebase Firestore
            const eventosRef = db.collection(`${cliente}`).doc("SEU_DOCUMENTO_ID").collection("eventos");
            eventosRef.doc(dataTimestamp.toString()).set({
                data: dataTimestamp,
                foto: downloadURL,
                descricao: descricao,
                promocao: promocao,
                regra: regra,
                link: link,
                buttonTitle: buttonTitle
            })
            .then(function () {
                alert("Evento cadastrado com sucesso!");
                location.reload();
            })
            .catch(function (error) {
                alert("Erro ao cadastrar evento: " + error.message);
            });
        });
    </script>
</body>
</html>
